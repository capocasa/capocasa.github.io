<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="https://www.w3.org/1999/xhtml" xml:lang="en" lang="en" data-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>at/t</title>

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- CSS -->
<link rel="stylesheet" type="text/css" href="nimdoc.out.css?v=2.2.4">

<!-- JS -->
<script type="text/javascript" src="dochack.js?v=2.2.4"></script>
</head>
<body>
  <div class="document" id="documentId">
    <div class="container">
      <h1 class="title">at/t</h1>
      <div class="row">
  <div class="three columns">
    <div class="theme-select-wrapper">
      <label for="theme-select">Theme:&nbsp;</label>
      <select id="theme-select" onchange="setTheme(this.value)">
        <option value="auto">ðŸŒ— Match OS</option>
        <option value="dark">ðŸŒ‘ Dark</option>
        <option value="light">ðŸŒ• Light</option>
      </select>
    </div>
    <div id="global-links">
      <ul class="simple">
        <li><a id="indexLink" href="theindex.html">Index</a></li>
      </ul>
    </div>
    <div id="searchInputDiv">
      Search: <input type="search" id="searchInput" oninput="search()"/>
    </div>
    <div>
      Group by:
      <select onchange="groupBy(this.value)">
        <option value="section">Section</option>
        <option value="type">Type</option>
      </select>
    </div>
    <ul class="simple simple-toc" id="toc-list">
  <li><a class="reference" id="whyqmark_toc" href="#whyqmark">Why?</a></li>
<li><a class="reference" id="use-cases_toc" href="#use-cases">Use cases</a></li>
<li><a class="reference" id="features_toc" href="#features">Features</a></li>
<li><a class="reference" id="differences-from-nimat_toc" href="#differences-from-nimat">Differences from <tt class="docutils literal"><span class="pre"><span class="Identifier">at</span></span></tt></a></li>
<li><a class="reference" id="limitations_toc" href="#limitations">Limitations</a></li>
<li><a class="reference" id="usage_toc" href="#usage">Usage</a></li>
<ul class="simple"><li><a class="reference" id="usage-in-memory_toc" href="#usage-in-memory">In Memory</a></li>
<li><a class="reference" id="usage-onminusdisk_toc" href="#usage-onminusdisk">On-Disk</a></li>
</ul><li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#7" id="57">Types</a></summary>
    <ul class="simple simple-toc-section">
      <li><a class="reference" href="#Att" title="Att[TTimeToKey; TTable2] = object
  t2k*: TTimeToKey
  k2t*: TTable2
  lock*: Lock
  cond*: Cond
  thread*: Thread[pointer]
  running*: bool">Att</a></li>

    </ul>
  </details>
</li>
<li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#12" id="62">Procs</a></summary>
    <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">[]=
  <li><a class="reference" href="#%5B%5D%3D%2CAtt%2CT%2CDuration" title="`[]=`[T](a: var Att; key: T; d: Duration)">`[]=`[T](a: var Att; key: T; d: Duration)</a></li>
<li><a class="reference" href="#%5B%5D%3D%2CAtt%2CT%2CTime" title="`[]=`[T](a: var Att; key: T; t: Time)">`[]=`[T](a: var Att; key: T; t: Time)</a></li>

</ul>
<ul class="simple nested-toc-section">del
  <li><a class="reference" href="#del%2CAtt%2CT" title="del[T](a: var Att; key: T)">del[T](a: var Att; key: T)</a></li>

</ul>
<ul class="simple nested-toc-section">initAtt
  <li><a class="reference" href="#initAtt%2CTTimeToKey%2CTTable2" title="initAtt[TTimeToKey, TTable2](t2k: TTimeToKey; k2t: TTable2): Att[TTimeToKey,
    TTable2]">initAtt[TTimeToKey, TTable2](t2k: TTimeToKey; k2t: TTable2): Att[TTimeToKey,
    TTable2]</a></li>

</ul>
<ul class="simple nested-toc-section">next
  <li><a class="reference" href="#next%2CAtt" title="next(a: Att): Time">next(a: Att): Time</a></li>

</ul>
<ul class="simple nested-toc-section">stop
  <li><a class="reference" href="#stop%2CAtt" title="stop(a: var Att)">stop(a: var Att)</a></li>

</ul>
<ul class="simple nested-toc-section">trigger
  <li><a class="reference" href="#trigger%2CAtt%2CTime%2CT" title="trigger[T](a: Att; t: Time; key: T)">trigger[T](a: Att; t: Time; key: T)</a></li>
<li><a class="reference" href="#trigger%2CTime%2CT" title="trigger[T](t: Time; key: T)">trigger[T](t: Time; key: T)</a></li>

</ul>
<ul class="simple nested-toc-section">waitCondUntil
  <li><a class="reference" href="#waitCondUntil%2CSysCondObj%2CSysLockObj%2CTime" title="waitCondUntil(cond: var Cond; lock: var Lock; deadline: Time)">waitCondUntil(cond: var Cond; lock: var Lock; deadline: Time)</a></li>

</ul>

    </ul>
  </details>
</li>
<li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#18" id="68">Templates</a></summary>
    <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">process
  <li><a class="reference" href="#process.t%2CAtt" title="process(a: var Att)">process(a: var Att)</a></li>

</ul>

    </ul>
  </details>
</li>

</ul>

  </div>
  <div class="nine columns" id="content">
    
    <div id="tocRoot"></div>
    
    <p class="module-desc"><p>A powerful, lightweight tool to execute code later, using threads</p>

<h1><a class="toc-backref" id="whyqmark" href="#whyqmark">Why?</a></h1><p><tt class="docutils literal"><span class="pre"><span class="Identifier">att</span></span></tt> is the thread-based equivalent of <tt class="docutils literal"><span class="pre"><span class="Identifier">at</span></span></tt>. If you don't use async in your application, or if you prefer the simplicity of threads, <tt class="docutils literal"><span class="pre"><span class="Identifier">att</span></span></tt> gives you the exact same functionality without pulling in <tt class="docutils literal"><span class="pre"><span class="Identifier">asyncdispatch</span></span></tt>.</p>
<p>It has all the same advantages as <tt class="docutils literal"><span class="pre"><span class="Identifier">at</span></span></tt>:</p>
<p>Transparency: The timers are all neatly accessible in a table instead of being hidden in a thread somewhere. Several <tt class="docutils literal"><span class="pre"><span class="Identifier">att</span></span></tt> instances can be used to group related timers or timers that do different things. That makes it this much easier to find bugs.</p>
<p>Flexibility: The timers can be easily modified or removed up until they are triggered. You can use any table you like as long as it keeps the keys sorted.</p>
<p>Persistence: Tables don't have to be in-memory. Using a table backed by persistent storage can preserve triggers across program restarts. Data is only ever read one-by-one after a trigger, so startup time is not meaningfully affected. And since the data is used directly off disk, you don't need to worry about whether the in-memory triggers are actually in sync with the on-disk triggers because the disk data is used directly. If you use a memory-mapped persistent table, this doesn't affect performance at all.</p>
<p>Thread safety: All table operations are protected by a lock, so you can safely add and remove triggers from any thread.</p>

<h1><a class="toc-backref" id="use-cases" href="#use-cases">Use cases</a></h1><p><em>Expiring Data</em></p>
<p>A really cool use-case is to remove ephemeral key/value pairs from an (additional) table, especially when persistent storage is used. For example, in a web app, this could be used for things like session key hashes, password reset link hashes, or incomplete form data you don't want to clutter your nice database with but are nice enough to store for your user.</p>
<p><em>Maintenance tasks</em></p>
<p>In most apps, maintenance tasks need to be performed- deleting old data, checking for updates, reminding the user to do stuff or simply doing stuff later. Traditionally, at least for web apps, external timers or special daemons are used, but it greatly simplifies both programming and administration to keep everything in-process.</p>

<h1><a class="toc-backref" id="features" href="#features">Features</a></h1><ul class="simple"><li>Simple-yet-effective implementation designed for tens of thousands of planned triggers using only one thread.</li>
<li>BYOT- bring your own table, you have full control over the table or table-like object used to store trigger information so you have full control over how data is stored. It's also fairly easy to write your own table interface, see the filesystem-storage example in <tt class="docutils literal"><span class="pre"><span class="Identifier">at</span></span></tt>.</li>
<li>No dependency on <tt class="docutils literal"><span class="pre"><span class="Identifier">asyncdispatch</span></span></tt>. If you're not using async, you don't have to start.</li>
</ul>

<h1><a class="toc-backref" id="differences-from-nimat" href="#differences-from-nimat">Differences from <tt class="docutils literal"><span class="pre"><span class="Identifier">at</span></span></tt></a></h1><p>The API is intentionally almost identical. Here's what's different:</p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Identifier">initAtt</span></span></tt> instead of <tt class="docutils literal"><span class="pre"><span class="Identifier">initAt</span></span></tt></li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">a</span><span class="Operator">.</span><span class="Identifier">process</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> instead of <tt class="docutils literal"><span class="pre"><span class="Identifier">asyncCheck</span> <span class="Identifier">a</span><span class="Operator">.</span><span class="Identifier">process</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt></li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">a</span><span class="Operator">.</span><span class="Identifier">stop</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> to cleanly shut down the processing thread when you're done</li>
<li>No need for <tt class="docutils literal"><span class="pre"><span class="Identifier">asyncdispatch</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">waitFor</span></span></tt> or <tt class="docutils literal"><span class="pre"><span class="Identifier">sleepAsync</span></span></tt></li>
</ul>

<h1><a class="toc-backref" id="limitations" href="#limitations">Limitations</a></h1><p>The table to look up times <tt class="docutils literal"><span class="pre"><span class="Identifier">t2k</span></span></tt> has to be one that is sorted by the key.</p>
<p>This is currently the case for:</p>
<p>In-Memory tables: <tt class="docutils literal"><span class="pre"><span class="Identifier">std</span><span class="Operator">/</span><span class="Identifier">bitcrittree</span></span></tt> (requires some boilerplate), <tt class="docutils literal"><span class="pre"><span class="Identifier">fusion</span><span class="Operator">/</span><span class="Identifier">btreetable</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">pkg</span><span class="Operator">/</span><span class="Identifier">sorta</span></span></tt>.</p>
<p>Persistent tables: <tt class="docutils literal"><span class="pre"><span class="Identifier">pkg</span><span class="Operator">/</span><span class="Identifier">limdb</span></span></tt> (requires supplied type conversion), <tt class="docutils literal"><span class="pre"><span class="Identifier">pkg</span><span class="Operator">/</span><span class="Identifier">nimdbx</span></span></tt> (untested)</p>
<p>Other tables can be of any type.</p>

<h1><a class="toc-backref" id="usage" href="#usage">Usage</a></h1>
<h2><a class="toc-backref" id="usage-in-memory" href="#usage-in-memory">In Memory</a></h2><p>It's often good to stick to the standard library as much as possible, however the only key-sorted table in the standard libary is the <tt class="docutils literal"><span class="pre"><span class="Identifier">CritBitTable</span></span></tt>. This has a somewhat different interface to regular tables, so a bit of boilerplate code is needed to convince it to act like one. Also only strings are supported for the keys, so we have to define some converters. This boilerplate can be omitted for other tables.</p>
<p><pre class="listing"><span class="Keyword">import</span> <span class="Identifier">std</span><span class="Operator">/</span><span class="Punctuation">[</span><span class="Identifier">os</span><span class="Punctuation">,</span> <span class="Identifier">times</span><span class="Punctuation">,</span> <span class="Identifier">tables</span><span class="Punctuation">,</span> <span class="Identifier">critbits</span><span class="Punctuation">]</span><span class="Punctuation">,</span> <span class="Identifier">at</span><span class="Operator">/</span><span class="Identifier">t</span><span class="Punctuation">,</span> <span class="Identifier">at</span><span class="Operator">/</span><span class="Identifier">timeblobs</span>

<span class="Comment"># a critbittree requires some boilerplate to be used like a regular table, of type [Time, string]</span>
<span class="Keyword">proc</span> <span class="Identifier">initCritBitTree</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">CritBitTree</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Operator">=</span>
  <span class="Keyword">discard</span>
<span class="Keyword">iterator</span> <span class="Identifier">keys</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">t</span><span class="Punctuation">:</span> <span class="Identifier">CritBitTree</span><span class="Punctuation">[</span><span class="Identifier">string</span><span class="Punctuation">]</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">Time</span> <span class="Operator">=</span>
  <span class="Keyword">for</span> <span class="Identifier">k</span> <span class="Keyword">in</span> <span class="Identifier">critbits</span><span class="Operator">.</span><span class="Identifier">keys</span><span class="Punctuation">(</span><span class="Identifier">t</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
    <span class="Keyword">yield</span> <span class="Identifier">k</span><span class="Operator">.</span><span class="Identifier">blobToTime</span>
<span class="Keyword">proc</span> <span class="Identifier">del</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">tab</span><span class="Punctuation">:</span> <span class="Keyword">var</span> <span class="Identifier">CritBitTree</span><span class="Punctuation">,</span> <span class="Identifier">t</span><span class="Punctuation">:</span> <span class="Identifier">Time</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Identifier">tab</span><span class="Operator">.</span><span class="Identifier">excl</span> <span class="Identifier">t</span><span class="Operator">.</span><span class="Identifier">timeToBlob</span>
<span class="Keyword">template</span> <span class="Punctuation">`</span><span class="Punctuation">[</span><span class="Punctuation">]</span><span class="Punctuation">`</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">CritBitTree</span><span class="Punctuation">,</span> <span class="Identifier">t</span><span class="Punctuation">:</span> <span class="Identifier">Time</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Identifier">a</span><span class="Punctuation">[</span><span class="Identifier">t</span><span class="Operator">.</span><span class="Identifier">timeToBlob</span><span class="Punctuation">]</span>
<span class="Keyword">template</span> <span class="Punctuation">`</span><span class="Punctuation">[</span><span class="Punctuation">]</span><span class="Operator">=</span><span class="Punctuation">`</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">CritBitTree</span><span class="Punctuation">,</span> <span class="Identifier">t</span><span class="Punctuation">:</span> <span class="Identifier">Time</span><span class="Punctuation">,</span> <span class="Identifier">s</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Identifier">a</span><span class="Punctuation">[</span><span class="Identifier">t</span><span class="Operator">.</span><span class="Identifier">timeToBlob</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">s</span>

<span class="Comment"># Now that we've got the critbit behaving like a proper table,</span>
<span class="Comment"># we can get started.</span>

<span class="Comment"># We store our ephemeral data in a regular table. Note it's a `ref`</span>
<span class="Comment"># otherwise the modifications would be made on a copy.</span>

<span class="Keyword">let</span> <span class="Identifier">data</span> <span class="Operator">=</span> <span class="Identifier">newTable</span><span class="Punctuation">[</span><span class="Identifier">string</span><span class="Punctuation">,</span> <span class="Identifier">string</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Punctuation">)</span>

<span class="Comment"># Now we add a trigger proc that `att` will call.</span>
<span class="Comment"># It accesses `data` as a global, but it can be placed into</span>
<span class="Comment"># a proc to use a closure instead.</span>

<span class="Keyword">proc</span> <span class="Identifier">trigger</span><span class="Punctuation">(</span><span class="Identifier">t</span><span class="Punctuation">:</span> <span class="Identifier">Time</span><span class="Punctuation">,</span> <span class="Identifier">k</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">)</span> <span class="Operator">=</span>
    <span class="Identifier">data</span><span class="Operator">.</span><span class="Identifier">del</span> <span class="Identifier">k</span>

<span class="Comment"># Now we can initialize `att`. We make two tables and pass them in.</span>
<span class="Comment"># This allows for a lot of flexibility.</span>
<span class="Keyword">let</span> <span class="Identifier">aa</span> <span class="Operator">=</span> <span class="Identifier">initAtt</span><span class="Punctuation">(</span><span class="Identifier">initCritBitTree</span><span class="Punctuation">[</span><span class="Identifier">string</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">,</span> <span class="Identifier">initTable</span><span class="Punctuation">[</span><span class="Identifier">string</span><span class="Punctuation">,</span> <span class="Identifier">Time</span><span class="Punctuation">]</span><span class="Punctuation">)</span>
<span class="Identifier">aa</span><span class="Operator">.</span><span class="Identifier">process</span><span class="Punctuation">(</span><span class="Punctuation">)</span>

<span class="Comment"># now let's add some data that will be deleted in three seconds</span>
<span class="Identifier">data</span><span class="Punctuation">[</span><span class="StringLit">&quot;foo&quot;</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="StringLit">&quot;bar&quot;</span>
<span class="Identifier">aa</span><span class="Punctuation">[</span><span class="StringLit">&quot;foo&quot;</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">initDuration</span><span class="Punctuation">(</span><span class="Identifier">seconds</span><span class="Operator">=</span><span class="DecNumber">3</span><span class="Punctuation">)</span>

<span class="Comment"># when you're done, stop the processing thread</span>
<span class="Comment"># aa.stop()</span></pre></p>
<p>If you don't mind using nimble packages, there is a really nice module <tt class="docutils literal"><span class="pre"><span class="Identifier">btreetables</span></span></tt> in the <tt class="docutils literal"><span class="pre"><span class="Identifier">fusion</span></span></tt> package that can be used.</p>
<p><pre class="listing"><span class="Keyword">import</span> <span class="Identifier">times</span><span class="Punctuation">,</span> <span class="Identifier">at</span><span class="Operator">/</span><span class="Identifier">t</span><span class="Punctuation">,</span> <span class="Identifier">fusion</span><span class="Operator">/</span><span class="Identifier">btreetables</span>
<span class="Keyword">let</span> <span class="Identifier">data</span> <span class="Operator">=</span> <span class="Identifier">newTable</span><span class="Punctuation">[</span><span class="Identifier">string</span><span class="Punctuation">,</span> <span class="Identifier">string</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Punctuation">)</span>  <span class="Comment"># this is a btree table too but could be a regular one</span>
<span class="Keyword">proc</span> <span class="Identifier">trigger</span><span class="Punctuation">(</span><span class="Identifier">t</span><span class="Punctuation">:</span> <span class="Identifier">Time</span><span class="Punctuation">,</span> <span class="Identifier">k</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">)</span> <span class="Operator">=</span>
    <span class="Identifier">data</span><span class="Operator">.</span><span class="Identifier">del</span> <span class="Identifier">k</span>
<span class="Keyword">let</span> <span class="Identifier">aa</span> <span class="Operator">=</span> <span class="Identifier">initAtt</span><span class="Punctuation">(</span><span class="Identifier">newTable</span><span class="Punctuation">[</span><span class="Identifier">Time</span><span class="Punctuation">,</span> <span class="Identifier">string</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">,</span> <span class="Identifier">newTable</span><span class="Punctuation">[</span><span class="Identifier">string</span><span class="Punctuation">,</span> <span class="Identifier">Time</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
<span class="Identifier">aa</span><span class="Operator">.</span><span class="Identifier">process</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Identifier">data</span><span class="Punctuation">[</span><span class="StringLit">&quot;foo&quot;</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="StringLit">&quot;bar&quot;</span>
<span class="Identifier">aa</span><span class="Punctuation">[</span><span class="StringLit">&quot;foo&quot;</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">initDuration</span><span class="Punctuation">(</span><span class="Identifier">seconds</span><span class="Operator">=</span><span class="DecNumber">3</span><span class="Punctuation">)</span></pre></p>
<p><tt class="docutils literal"><span class="pre"><span class="Identifier">sorta</span></span></tt> tables from nimble work great too</p>
<p><pre class="listing"><span class="Keyword">import</span> <span class="Identifier">times</span><span class="Punctuation">,</span> <span class="Identifier">sorta</span><span class="Punctuation">,</span> <span class="Identifier">at</span><span class="Operator">/</span><span class="Identifier">t</span><span class="Punctuation">,</span> <span class="Identifier">tables</span>
<span class="Keyword">var</span> <span class="Identifier">s</span> <span class="Operator">=</span> <span class="Identifier">initSortedTable</span><span class="Punctuation">[</span><span class="Identifier">string</span><span class="Punctuation">,</span> <span class="Identifier">Time</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">var</span> <span class="Identifier">data</span> <span class="Operator">=</span> <span class="Identifier">newTable</span><span class="Punctuation">[</span><span class="Identifier">string</span><span class="Punctuation">,</span> <span class="Identifier">string</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Keyword">proc</span> <span class="Identifier">trigger</span><span class="Punctuation">(</span><span class="Identifier">t</span><span class="Punctuation">:</span> <span class="Identifier">Time</span><span class="Punctuation">,</span> <span class="Identifier">k</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">)</span> <span class="Operator">=</span>
<span class="Identifier">data</span><span class="Operator">.</span><span class="Identifier">del</span> <span class="Identifier">k</span>
<span class="Keyword">let</span> <span class="Identifier">aa</span> <span class="Operator">=</span> <span class="Identifier">initAtt</span><span class="Punctuation">(</span><span class="Identifier">initSortedTable</span><span class="Punctuation">[</span><span class="Identifier">Time</span><span class="Punctuation">,</span> <span class="Identifier">string</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">,</span> <span class="Identifier">initSortedTable</span><span class="Punctuation">[</span><span class="Identifier">string</span><span class="Punctuation">,</span> <span class="Identifier">Time</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
<span class="Identifier">aa</span><span class="Operator">.</span><span class="Identifier">process</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Identifier">data</span><span class="Punctuation">[</span><span class="StringLit">&quot;foo&quot;</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="StringLit">&quot;bar&quot;</span>
<span class="Identifier">aa</span><span class="Punctuation">[</span><span class="StringLit">&quot;foo&quot;</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">initDuration</span><span class="Punctuation">(</span><span class="Identifier">seconds</span><span class="Operator">=</span><span class="DecNumber">3</span><span class="Punctuation">)</span></pre></p>

<h2><a class="toc-backref" id="usage-onminusdisk" href="#usage-onminusdisk">On-Disk</a></h2><p>Now for the main event- <tt class="docutils literal"><span class="pre"><span class="Identifier">att</span></span></tt> really shines when it comes to expiring values that are persisted to disk- a key-value database, as there is no need to load the time information from disk into memory storage and keep it in sync- everything stays on disk until there is a trigger.</p>
<p>Just give <tt class="docutils literal"><span class="pre"><span class="Identifier">att</span></span></tt> a table-like interface to the database and you're good to go. As an example, you could create your own filesystem-based persistence layer. That's not particularly fast compared to other options out there but it works and does not require any dependencies.</p>
<p><pre class="listing"><span class="Comment"># TODO: add file system database example</span></pre></p>
<p>Most likely, you will prefer to use a tried-and-true key-value store like LMDB- here wrapped into a table-like interface by LimDB:</p>
<p><pre class="listing"><span class="Keyword">import</span> <span class="Identifier">at</span><span class="Operator">/</span><span class="Identifier">t</span><span class="Punctuation">,</span> <span class="Identifier">os</span><span class="Punctuation">,</span> <span class="Identifier">limdb</span><span class="Punctuation">,</span> <span class="Identifier">times</span><span class="Punctuation">,</span> <span class="Identifier">at</span><span class="Operator">/</span><span class="Identifier">timeblobs</span>

<span class="Comment"># LimDB requires some boilerplate because it only supports strings</span>
<span class="Keyword">iterator</span> <span class="Identifier">keys</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">limdb</span><span class="Operator">.</span><span class="Identifier">Database</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">Time</span> <span class="Operator">=</span>
  <span class="Keyword">for</span> <span class="Identifier">k</span> <span class="Keyword">in</span> <span class="Identifier">limdb</span><span class="Operator">.</span><span class="Identifier">keys</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
    <span class="Keyword">yield</span> <span class="Identifier">k</span><span class="Operator">.</span><span class="Identifier">blobToTime</span>
<span class="Keyword">proc</span> <span class="Identifier">del</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">limdb</span><span class="Operator">.</span><span class="Identifier">Database</span><span class="Punctuation">,</span> <span class="Identifier">t</span><span class="Punctuation">:</span> <span class="Identifier">Time</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Identifier">a</span><span class="Operator">.</span><span class="Identifier">del</span> <span class="Identifier">t</span><span class="Operator">.</span><span class="Identifier">timeToBlob</span>

<span class="Keyword">template</span> <span class="Punctuation">`</span><span class="Punctuation">[</span><span class="Punctuation">]</span><span class="Punctuation">`</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">limdb</span><span class="Operator">.</span><span class="Identifier">Database</span><span class="Punctuation">,</span> <span class="Identifier">t</span><span class="Punctuation">:</span> <span class="Identifier">Time</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Identifier">limdb</span><span class="Operator">.</span><span class="Punctuation">`</span><span class="Punctuation">[</span><span class="Punctuation">]</span><span class="Punctuation">`</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">,</span> <span class="Identifier">t</span><span class="Operator">.</span><span class="Identifier">timeToBlob</span><span class="Punctuation">)</span>
<span class="Keyword">template</span> <span class="Punctuation">`</span><span class="Punctuation">[</span><span class="Punctuation">]</span><span class="Punctuation">`</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">limdb</span><span class="Operator">.</span><span class="Identifier">Database</span><span class="Punctuation">,</span> <span class="Identifier">s</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">Time</span> <span class="Operator">=</span>
  <span class="Identifier">limdb</span><span class="Operator">.</span><span class="Punctuation">`</span><span class="Punctuation">[</span><span class="Punctuation">]</span><span class="Punctuation">`</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">,</span> <span class="Identifier">s</span><span class="Operator">.</span><span class="Identifier">blobToTime</span><span class="Punctuation">)</span>
<span class="Keyword">template</span> <span class="Punctuation">`</span><span class="Punctuation">[</span><span class="Punctuation">]</span><span class="Operator">=</span><span class="Punctuation">`</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">limdb</span><span class="Operator">.</span><span class="Identifier">Database</span><span class="Punctuation">,</span> <span class="Identifier">t</span><span class="Punctuation">:</span> <span class="Identifier">Time</span><span class="Punctuation">,</span> <span class="Identifier">s</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Identifier">limdb</span><span class="Operator">.</span><span class="Punctuation">`</span><span class="Punctuation">[</span><span class="Punctuation">]</span><span class="Operator">=</span><span class="Punctuation">`</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">,</span> <span class="Identifier">t</span><span class="Operator">.</span><span class="Identifier">timeToBlob</span><span class="Punctuation">,</span> <span class="Identifier">s</span><span class="Punctuation">)</span>
<span class="Keyword">template</span> <span class="Punctuation">`</span><span class="Punctuation">[</span><span class="Punctuation">]</span><span class="Operator">=</span><span class="Punctuation">`</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">limdb</span><span class="Operator">.</span><span class="Identifier">Database</span><span class="Punctuation">,</span> <span class="Identifier">s</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">,</span> <span class="Identifier">t</span><span class="Punctuation">:</span> <span class="Identifier">Time</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Identifier">limdb</span><span class="Operator">.</span><span class="Punctuation">`</span><span class="Punctuation">[</span><span class="Punctuation">]</span><span class="Operator">=</span><span class="Punctuation">`</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">,</span> <span class="Identifier">s</span><span class="Punctuation">,</span> <span class="Identifier">t</span><span class="Operator">.</span><span class="Identifier">timeToBlob</span><span class="Punctuation">)</span>

<span class="Keyword">let</span> <span class="Identifier">data</span> <span class="Operator">=</span> <span class="Identifier">initDatabase</span><span class="Punctuation">(</span><span class="Identifier">getTempDir</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Operator">/</span> <span class="StringLit">&quot;limdb&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;main&quot;</span><span class="Punctuation">)</span>

<span class="Keyword">proc</span> <span class="Identifier">trigger</span><span class="Punctuation">(</span><span class="Identifier">t</span><span class="Punctuation">:</span> <span class="Identifier">Time</span><span class="Punctuation">,</span> <span class="Identifier">k</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Identifier">data</span><span class="Operator">.</span><span class="Identifier">del</span> <span class="Identifier">k</span>

<span class="Keyword">let</span> <span class="Identifier">aa</span> <span class="Operator">=</span> <span class="Identifier">initAtt</span><span class="Punctuation">(</span><span class="Identifier">data</span><span class="Operator">.</span><span class="Identifier">initDatabase</span><span class="Punctuation">(</span><span class="StringLit">&quot;att time-to-key&quot;</span><span class="Punctuation">)</span><span class="Punctuation">,</span> <span class="Identifier">data</span><span class="Operator">.</span><span class="Identifier">initDatabase</span><span class="Punctuation">(</span><span class="StringLit">&quot;att key-to-time&quot;</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
<span class="Identifier">aa</span><span class="Operator">.</span><span class="Identifier">process</span><span class="Punctuation">(</span><span class="Punctuation">)</span>

<span class="Identifier">data</span><span class="Punctuation">[</span><span class="StringLit">&quot;foo&quot;</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="StringLit">&quot;bar&quot;</span>
<span class="Identifier">aa</span><span class="Punctuation">[</span><span class="StringLit">&quot;foo&quot;</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">initDuration</span><span class="Punctuation">(</span><span class="Identifier">seconds</span><span class="Operator">=</span><span class="DecNumber">3</span><span class="Punctuation">)</span></pre></p>
<p>And this is how <tt class="docutils literal"><span class="pre"><span class="Identifier">att</span></span></tt> is meant to be used. </p>
</p>
    <div class="section" id="7">
  <h1><a class="toc-backref" href="#7">Types</a></h1>
  <dl class="item">
    <div id="Att">
  <dt><pre><a href="t.html#Att"><span class="Identifier">Att</span></a><span class="Other">[</span><span class="Identifier">TTimeToKey</span><span class="Other">;</span> <span class="Identifier">TTable2</span><span class="Other">]</span> <span class="Other">=</span> <span class="Keyword">object</span>
  <span class="Identifier">t2k</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">TTimeToKey</span>
  <span class="Identifier">k2t</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">TTable2</span>
  <span class="Identifier">lock</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">Lock</span>
  <span class="Identifier">cond</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">Cond</span>
  <span class="Identifier">thread</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">Thread</span><span class="Other">[</span><span class="Identifier">pointer</span><span class="Other">]</span>
  <span class="Identifier">running</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">bool</span></pre></dt>
  <dd>
    
    A powerful, lightweight tool to execute code later, using threads.
    
  </dd>
</div>

  </dl>
</div>
<div class="section" id="12">
  <h1><a class="toc-backref" href="#12">Procs</a></h1>
  <dl class="item">
    <div id="[]=-procs-all">
  <div id="[]=,Att,T,Duration">
  <dt><pre><span class="Keyword">proc</span> <a href="#%5B%5D%3D%2CAtt%2CT%2CDuration"><span class="Identifier">`[]=`</span></a><span class="Other">[</span><span class="Identifier">T</span><span class="Other">]</span><span class="Other">(</span><span class="Identifier">a</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="t.html#Att"><span class="Identifier">Att</span></a><span class="Other">;</span> <span class="Identifier">key</span><span class="Other">:</span> <span class="Identifier">T</span><span class="Other">;</span> <span class="Identifier">d</span><span class="Other">:</span> <span class="Identifier">Duration</span><span class="Other">)</span></pre></dt>
  <dd>
    
    Set a trigger relative to now.
    
  </dd>
</div>
<div id="[]=,Att,T,Time">
  <dt><pre><span class="Keyword">proc</span> <a href="#%5B%5D%3D%2CAtt%2CT%2CTime"><span class="Identifier">`[]=`</span></a><span class="Other">[</span><span class="Identifier">T</span><span class="Other">]</span><span class="Other">(</span><span class="Identifier">a</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="t.html#Att"><span class="Identifier">Att</span></a><span class="Other">;</span> <span class="Identifier">key</span><span class="Other">:</span> <span class="Identifier">T</span><span class="Other">;</span> <span class="Identifier">t</span><span class="Other">:</span> <span class="Identifier">Time</span><span class="Other">)</span></pre></dt>
  <dd>
    
    Set a trigger as an absolute time.
    
  </dd>
</div>

</div>
<div id="del-procs-all">
  <div id="del,Att,T">
  <dt><pre><span class="Keyword">proc</span> <a href="#del%2CAtt%2CT"><span class="Identifier">del</span></a><span class="Other">[</span><span class="Identifier">T</span><span class="Other">]</span><span class="Other">(</span><span class="Identifier">a</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="t.html#Att"><span class="Identifier">Att</span></a><span class="Other">;</span> <span class="Identifier">key</span><span class="Other">:</span> <span class="Identifier">T</span><span class="Other">)</span></pre></dt>
  <dd>
    
    Manually remove a trigger by its key
    
  </dd>
</div>

</div>
<div id="initAtt-procs-all">
  <div id="initAtt,TTimeToKey,TTable2">
  <dt><pre><span class="Keyword">proc</span> <a href="#initAtt%2CTTimeToKey%2CTTable2"><span class="Identifier">initAtt</span></a><span class="Other">[</span><span class="Identifier">TTimeToKey</span><span class="Other">,</span> <span class="Identifier">TTable2</span><span class="Other">]</span><span class="Other">(</span><span class="Identifier">t2k</span><span class="Other">:</span> <span class="Identifier">TTimeToKey</span><span class="Other">;</span> <span class="Identifier">k2t</span><span class="Other">:</span> <span class="Identifier">TTable2</span><span class="Other">)</span><span class="Other">:</span> <a href="t.html#Att"><span class="Identifier">Att</span></a><span class="Other">[</span>
    <span class="Identifier">TTimeToKey</span><span class="Other">,</span> <span class="Identifier">TTable2</span><span class="Other">]</span></pre></dt>
  <dd>
    
    <p>Initialize an <tt class="docutils literal"><span class="pre"><span class="Identifier">att</span></span></tt> tool to execute code later using threads.</p>
<p>You give it two tables or table-like objects, one to store times and associated keys, in the others the keys are mapped to the times in case they need to be looked up.</p>
<p>The time-to-key table needs to be of the kind that sorts by its keys.</p>

    
  </dd>
</div>

</div>
<div id="next-procs-all">
  <div id="next,Att">
  <dt><pre><span class="Keyword">proc</span> <a href="#next%2CAtt"><span class="Identifier">next</span></a><span class="Other">(</span><span class="Identifier">a</span><span class="Other">:</span> <a href="t.html#Att"><span class="Identifier">Att</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">Time</span></pre></dt>
  <dd>
    
    Internal use, uses the <tt class="docutils literal"><span class="pre"><span class="Identifier">keys</span></span></tt> iterator to get the first time of the times-to-keys table to start waiting.
    
  </dd>
</div>

</div>
<div id="stop-procs-all">
  <div id="stop,Att">
  <dt><pre><span class="Keyword">proc</span> <a href="#stop%2CAtt"><span class="Identifier">stop</span></a><span class="Other">(</span><span class="Identifier">a</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="t.html#Att"><span class="Identifier">Att</span></a><span class="Other">)</span></pre></dt>
  <dd>
    
    Stop the processing thread and wait for it to finish.
    
  </dd>
</div>

</div>
<div id="trigger-procs-all">
  <div id="trigger,Att,Time,T">
  <dt><pre><span class="Keyword">proc</span> <a href="#trigger%2CAtt%2CTime%2CT"><span class="Identifier">trigger</span></a><span class="Other">[</span><span class="Identifier">T</span><span class="Other">]</span><span class="Other">(</span><span class="Identifier">a</span><span class="Other">:</span> <a href="t.html#Att"><span class="Identifier">Att</span></a><span class="Other">;</span> <span class="Identifier">t</span><span class="Other">:</span> <span class="Identifier">Time</span><span class="Other">;</span> <span class="Identifier">key</span><span class="Other">:</span> <span class="Identifier">T</span><span class="Other">)</span></pre></dt>
  <dd>
    
    This is a trigger that allows access to the <tt class="docutils literal"><span class="pre"><span class="Identifier">att</span></span></tt> object. Use with caution. Don't implement both if you don't want both to run.
    
  </dd>
</div>
<div id="trigger,Time,T">
  <dt><pre><span class="Keyword">proc</span> <a href="#trigger%2CTime%2CT"><span class="Identifier">trigger</span></a><span class="Other">[</span><span class="Identifier">T</span><span class="Other">]</span><span class="Other">(</span><span class="Identifier">t</span><span class="Other">:</span> <span class="Identifier">Time</span><span class="Other">;</span> <span class="Identifier">key</span><span class="Other">:</span> <span class="Identifier">T</span><span class="Other">)</span></pre></dt>
  <dd>
    
    This is a trigger that does nothing. This needs to be implemented by you- copy the definition and place it in the same file you instantiate <tt class="docutils literal"><span class="pre"><span class="Identifier">tat</span></span></tt> in.
    
  </dd>
</div>

</div>
<div id="waitCondUntil-procs-all">
  <div id="waitCondUntil,SysCondObj,SysLockObj,Time">
  <dt><pre><span class="Keyword">proc</span> <a href="#waitCondUntil%2CSysCondObj%2CSysLockObj%2CTime"><span class="Identifier">waitCondUntil</span></a><span class="Other">(</span><span class="Identifier">cond</span><span class="Other">:</span> <span class="Keyword">var</span> <span class="Identifier">Cond</span><span class="Other">;</span> <span class="Identifier">lock</span><span class="Other">:</span> <span class="Keyword">var</span> <span class="Identifier">Lock</span><span class="Other">;</span> <span class="Identifier">deadline</span><span class="Other">:</span> <span class="Identifier">Time</span><span class="Other">)</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    Wait on a condition variable until an absolute deadline.
    
  </dd>
</div>

</div>

  </dl>
</div>
<div class="section" id="18">
  <h1><a class="toc-backref" href="#18">Templates</a></h1>
  <dl class="item">
    <div id="process-templates-all">
  <div id="process.t,Att">
  <dt><pre><span class="Keyword">template</span> <a href="#process.t%2CAtt"><span class="Identifier">process</span></a><span class="Other">(</span><span class="Identifier">a</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="t.html#Att"><span class="Identifier">Att</span></a><span class="Other">)</span></pre></dt>
  <dd>
    
    Call after initializing to start processing in a background thread.
    
  </dd>
</div>

</div>

  </dl>
</div>

  </div>
</div>

      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br>
        <small style="color: var(--hint);">Made with Nim. Generated: 2026-02-15 12:29:47 UTC</small>
      </div>
    </div>
  </div>
  
</body>
</html>
